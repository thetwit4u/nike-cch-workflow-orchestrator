{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Generic Command for Workflow Orchestrator",
  "description": "The standard payload sent to the Workflow Orchestrator to initiate or advance a workflow.",
  "version": "0.0.1",
  "type": "object",
  "properties": {
    "workflowInstanceId": {
      "type": "string",
      "description": "A unique identifier (UUID) for the workflow instance.",
      "format": "uuid"
    },
    "workflowName": {
      "type": "string",
      "description": "The human-readable name of the workflow being executed (e.g., 'Import US Workflow'). Useful for logging and observability."
    },
    "correlationId": {
      "type": "string",
      "description": "End-to-end tracking ID, often a human-readable identifier (e.g., packlist number) used for tracing across systems and in UIs."
    },
    "workflowDefinitionURI": {
      "type": "string",
      "description": "A required pointer to the immutable, versioned S3 file containing the Workflow Definition.",
      "format": "uri"
    },
    "sourceEvent": {
      "type": "object",
      "description": "OPTIONAL: Provides traceability to the original external event that triggered this chain of actions. Primarily relevant for the initial command of type 'EVENT'.",
      "properties": {
        "eventType": {
          "type": "string",
          "description": "The type of the original business event (e.g., 'shipment-created')."
        },
        "eventId": {
          "type": "string",
          "description": "The unique ID of the original source event."
        },
        "timestamp": {
          "type": "string",
          "description": "The timestamp of when the original source event occurred.",
          "format": "date-time"
        },
        "eventDataURI": {
          "type": "string",
          "description": "A URI pointing to the full payload of the original source event, typically in S3.",
          "format": "uri"
        }
      },
      "required": ["eventType", "eventId", "timestamp", "eventDataURI"]
    },
    "command": {
      "type": "object",
      "description": "The specific command being sent to the orchestrator *now*.",
      "properties": {
        "type": {
          "type": "string",
          "description": "The type of command this is.",
          "enum": ["EVENT", "ASYNC_RESP", "HITL_RESP"]
        },
        "id": {
          "type": "string",
          "description": "A unique command ID for idempotency (workflowInstanceId + command.id must be unique).",
          "format": "uuid"
        },
        "source": {
          "type": "string",
          "description": "An identifier for the command's origin (e.g., 'TradeFlowController', 'Capability:EXPORT', 'Frontend:HITL_Approval')."
        },
        "timestamp": {
          "type": "string",
          "description": "ISO 8601 timestamp of when this command was generated.",
          "format": "date-time"
        },
        "payload": {
          "type": "object",
          "description": "The data payload associated with this specific command. The orchestrator will merge this into the main workflowContext.",
          "additionalProperties": true
        },
        "routingHint": {
          "type": "object",
          "description": "OPTIONAL: Provides info to route this command to a specific parallel branch within a workflow.",
          "properties": {
            "branchKey": {
              "type": "string",
              "description": "The unique key identifying the parallel branch to target (e.g., a filingPackId)."
            }
          }
        }
      },
      "required": ["type", "id", "source", "timestamp", "payload"]
    }
  },
  "required": ["workflowInstanceId", "correlationId", "command", "workflowDefinitionURI"]
}