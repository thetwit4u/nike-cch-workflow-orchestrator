{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "CapabilityCommand",
  "description": "Command for Trade Compliance Capability; The standard payload sent from the Workflow Orchestrator to a capability service.",
  "version": "0.0.1",
  "type": "object",
  "properties": {
    "header": {
      "type": "object",
      "description": "Contains metadata for routing, tracing, and replies.",
      "properties": {
        "workflowInstanceId": {
          "type": "string",
          "description": "The unique identifier of the workflow instance that is issuing this command. Used for tracing.",
          "format": "uuid"
        },
        "workflowDefinitionURI": {
          "type": "string",
          "description": "A required pointer to the immutable, versioned S3 file containing the Workflow Definition.",
          "format": "uri"
        },
        "correlationId": {
          "type": "string",
          "description": "The end-to-end business tracking ID (e.g., packlist number)."
        },
        "commandId": {
          "type": "string",
          "description": "A unique ID for this specific command message, generated by the Orchestrator. Used for idempotency by the capability.",
          "format": "uuid"
        },
        "replyToQueueUrl": {
          "type": "string",
          "description": "The SQS queue URL where the capability must send its asynchronous response.",
          "format": "uri"
        },
        "source": {
          "type": "string",
          "description": "Identifies the source of the command, always 'WorkflowOrchestrator'."
        },
        "timestamp": {
          "type": "string",
          "description": "ISO 8601 timestamp of when this command was generated.",
          "format": "date-time"
        },
        "routingHint": {
          "type": "object",
          "description": "OPTIONAL: Provides info for the capability to include in its response to route it to the correct branch within a workflow.",
          "properties": {
            "branchKey": {
              "type": "string",
              "description": "The unique key identifying the parallel branch this command is for (e.g., a filingPackId)."
            }
          }
        }
      },
      "required": ["workflowInstanceId", "correlationId", "commandId", "replyToQueueUrl", "source", "timestamp"]
    },
    "body": {
      "type": "object",
      "description": "Contains the functional business data for the capability to process.",
      "properties": {
        "capability_id": {
          "type": "string",
          "description": "Identifies the specific function to execute within the capability (e.g., 'import#enrichment')."
        },
        "request_output_keys": {
          "type": "array",
          "description": "OPTIONAL: A list of keys the capability is expected to return in its asynchronous response payload.",
          "items": {
            "type": "string"
          }
        },
        "context": {
          "type": "object",
          "description": "The data context required by the capability function. May contain S3 URIs for larger data objects.",
          "additionalProperties": true
        }
      },
      "required": ["capability_id", "context"]
    }
  },
  "required": ["header", "body"]
}
